(function(b){function a(){}a.prototype={createXhr:function(c){if(c){this.options=c;}var d=this;if(this.isIE()&&!this.isSameWithOrigin(this.url)){if(this.xhr){this.xhr.abort();}this.xhr=new XDomainRequest();this.xhr.onload=function(){d.onComplete();};this.xhr.onerror=function(){d.onError();};}else{if(!!window.XMLHttpRequest){this.xhr=new window.XMLHttpRequest();}else{if(!!window.ActiveXObject){this.xhr=new window.ActiveXObject("Microsoft.XMLHTTP");}}}if(!this.xhr){throw new Error("Unable to create XHR object!");}var d=this;this.xhr.onreadystatechange=function(){if(this.readyState===4){if(this.status>=400){d.onError();}else{d.onComplete();}}};this.xhr.onprogress=function(){};this.xhr.ontimeout=function(){throw new Error("timeout");};return;},abort:function(){this.xhr.abort();},isIE:function(){if(navigator.appVersion.indexOf("MSIE")!=-1){return true;}return false;},isSameWithOrigin:function(d){var f=new RegExp("^http(s)?://.*?(/|$)","i");var e=f.exec(d)[0];var c=f.exec(window.location.href)[0];return(c===e);},send:function(d,c){this.options=c;this.url=d;if(!this.xhr){this.createXhr();}this.xhr.open(c.method,d,true);this.xhr.timeout=20000;if(this.xhr.withCredentials!==undefined){if(c.withCredentials){this.xhr.withCredentials=c.withCredentials;}}if(this.xhr.setRequestHeader&&c.headers){for(var e=0;e<c.headers.length;e++){this.xhr.setRequestHeader(c.headers[e].name,c.headers[e].value);}}if(c.data){this.xhr.send(c.data);}else{this.xhr.send(null);}function f(){throw new Error("Loading timeout: "+d);}return this;},onComplete:function(){if(this.options.on.success){this.options.on.success(this.xhr.responseText);}},onError:function(){if(this.options.on.error){this.options.on.error(this.xhr.responseText);}}};b.ajax=function(c,d){return new a().send(c,d);};})(GA);(function(b){var a=new Class({$events:null,init:function(){this.$events={};},on:function(c,d){this.$events[c]=this.$events[c]||[];this.$events[c].push(d);},fire:function(c,g){var f=this.$events[c];if(f){for(var d in f){var e=f[d];e.apply(this,[g]);}}},detach:function(c,f){var e=this.$events[c];for(var d=0;d<e.length;d++){if(e[d]==f){delete e[d];return;}}return;}});b.EventManager=a;}(GA));(function(b){var a=b.EventManager.extend({init:function(){this._parent();},onMessage:function(d,c){b.dispatcher.on(d,b.bind(c,this));},sendMessage:function(d,c){b.dispatcher.fire(d,c);}});b.MsgManager=a;b.dispatcher=new a();}(GA));(function(d){var a=null;var c=".page";var b=d.EventManager.extend({tableName:"",filters:[],rowCount:20,cluster:null,showLoading:false,tables:[],init:function(e){if(a){throw new Error("You can only create one instance of DataManager!");}this._parent();},geocode:function(e,h,f){var f=f||{};var g=new google.maps.Geocoder();g.geocode({address:e},d.bind(function(o,n){if(n==google.maps.GeocoderStatus.OK){if(h){var m=[];var q=-1;for(var p=0;p<o.length;p++){q++;m.push({index:q,lat:o[p].geometry.location.lat(),lon:o[p].geometry.location.lng(),address:o[p].formatted_address,bounds:[o[p].geometry.viewport.getSouthWest().lat(),o[p].geometry.viewport.getSouthWest().lng(),o[p].geometry.viewport.getNorthEast().lat(),o[p].geometry.viewport.getNorthEast().lng()]});}if(f.success){f.success.apply(this,[m]);}}else{var r=o[0].geometry.location.lat();var k=o[0].geometry.location.lng();var l=o[0].formatted_address;var j=[o[0].geometry.viewport.getSouthWest().lat(),o[0].geometry.viewport.getSouthWest().lng(),o[0].geometry.viewport.getNorthEast().lat(),o[0].geometry.viewport.getNorthEast().lng()];if(f.success){f.success.apply(this,[r,k,l,j]);}}}},this));},reverseGeocode:function(i,f,e){var e=e||{};var h=new google.maps.Geocoder();var g=new google.maps.LatLng(i,f);h.geocode({latLng:g},d.bind(function(l,k){if(k==google.maps.GeocoderStatus.OK){var j=l[0].formatted_address;var m=l[0].geometry.viewport;if(e.success){e.success.apply(this,[j,m]);}}},this));},geolocateUser:function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(d.bind(function(e){this.reverseGeocode(e.coords.latitude,e.coords.longitude,{success:d.bind(function(f,g){this.geocodeBounds=[g.getSouthWest().lat(),g.getSouthWest().lng(),g.getNorthEast().lat(),g.getNorthEast().lng()];this.geocodeCenter=[e.coords.latitude,e.coords.longitude];var h={lat:e.coords.latitude,lon:e.coords.longitude,address:f,bounds:this.geocodeBounds};this.fire("userGeocoded",h);},this)});},this),d.bind(function(e){this.fire("userNotGeocoded");},this));}}});b.getInstance=function(){if(a){return a;}a=new b();return a;};d.DataManager=b;}(GA));(function(c){var b=null;var a=new Class({ad:{},geoAdsPlatformUrl:"http://127.0.0.1:1314/",init:function(){},setAdMapSettings:function(d,e){this.ad.center=d;this.ad.radius=e;},setAdInfoSettings:function(e,d){if(!e||!d){return;}this.ad.name=e;this.ad.description=d;},getAd:function(){return this.ad;},saveAd:function(){if(!this.ad||!this.ad.center||!this.ad.radius||!this.ad.name){return;}var e=this.geoAdsPlatformUrl+"savead/";e+=this.ad.name+"/";e+=this.ad.center.lat+"/"+this.ad.center.lon+"/";e+=this.ad.radius;var d={method:"GET",on:{success:c.bind(function(f){alert("Great success!");},this),error:function(f){console.log(f);}},headers:[{name:"Content-Type",value:"text/plain"}]};if(!c.ajax){throw new Error("Ajax function is not defined");}jQuery.ajax({url:e,type:"GET",success:function(f){alert("Great Success");}});}});a.getInstance=function(){if(b){return b;}b=new a();return b;};c.AdManager=a;}(GA));(function(b){var a=b.MsgManager.extend({app:null,mustache:null,templates:null,init:function(c){this.mustache=b.mustache;this.templates=c.templates;this.container=c.container;this.renderContainer=c.renderContainer;this.hideOnStates=c.hideOnStates||[];this.formatRenderData=c.formatRenderData;this.dataManager=b.DataManager.getInstance();this.adManager=b.AdManager.getInstance();this.ajax=b.ajax;this.events=b.extend(this.events||{},c.events||{});this.parseEvents();this.register();},register:function(){},render:function(){},parseEvents:function(){var e=this.events||{};for(var c in e){for(var d in e[c]){var f=this[e[c][d]]||e[c][d];
b.delegate(this.container,c,d,b.bind(f,this));}}},getDictionary:function(){return b.LanguageManager.getInstance().dictionary;}});b.View=a;}(GA));(function(b){var a=b.View.extend({map:null,maxRadius:2000,events:{"#next-step":{click:"onNextStepClick"}},init:function(c){this._parent(c);this.dataManager.on("userGeocoded",b.bind(this.onUserGeocoded,this));this.markerInfo=c.markerInfo||{url:"images/orange-pin.png",position:{lat:45.757284,lng:21.228633}};this.radius=c.radius||100;if(this.radius>this.maxRadius){this.radius=this.maxRadius;}this.startZoom=c.startZoom||3;},register:function(){this.onMessage("drawMarker",this.onDrawMarker);},render:function(){var c={zoom:this.startZoom,center:new google.maps.LatLng(this.markerInfo.position.lat,this.markerInfo.position.lng),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT},panControl:false,zoomControl:false,streetViewControl:false,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},};this.map=new google.maps.Map(this.renderContainer,c);return this;},centerAndZoom:function(c,d){if(!c||!c.lat||!c.lon||!d){return;}var c=new google.maps.LatLng(c.lat,c.lon);this.map.setCenter(c);this.map.setZoom(d);},drawMarker:function(c){this.markerInfo=c||this.markerInfo;if(!this.markerInfo){return;}if(!this.marker){this.createMarker(this.markerInfo);}else{this.marker.setPosition(new google.maps.LatLng(this.markerInfo.position.lat,this.markerInfo.position.lng));}this.centerAndZoom({lat:this.markerInfo.position.lat,lon:this.markerInfo.position.lng},17);this.drawCoverage();this.marker.adCoverage=this.adCoverage;this.adCoverage.bindTo("map",this.marker);this.adCoverage.bindTo("center",this.marker,"position");google.maps.event.addListener(this.marker,"dragend",b.bind(function(){this.drawCoverage();},this));},createMarker:function(c){this.marker=new google.maps.Marker({map:this.map,animation:google.maps.Animation.DROP,draggable:true,icon:c.url,position:new google.maps.LatLng(c.position.lat,c.position.lng)});},drawCoverage:function(){var c=this.marker.getPosition();if(!this.adCoverage){this.adCoverage=new google.maps.Circle({editable:true,center:c,radius:this.radius,strokeColor:"#008CE4",strokeOpacity:0.5,strokeWeight:1,fillColor:"#00A4E4",fillOpacity:0.3});}else{this.adCoverage.setCenter(c);}google.maps.event.addListener(this.adCoverage,"radius_changed",b.bind(function(d){if(this.adCoverage.radius>this.maxRadius){this.adCoverage.setRadius(this.maxRadius);}},this));this.adCoverage.setMap(this.map);google.maps.event.trigger(this.map,"resize");},onDrawMarker:function(d){if(!d||!d.lat||!d.lon){return;}var c={};c.url=this.markerInfo.url;c.position={};c.position.lat=d.lat;c.position.lng=d.lon;this.drawMarker(c);},onUserGeocoded:function(d){if(!d||!d.lat||!d.lon){return;}var c={};c.url=this.markerInfo.url;c.position={};c.position.lat=d.lat;c.position.lng=d.lon;this.drawMarker(c);},onNextStepClick:function(c){var d=this.marker.getPosition();var e=this.adCoverage.getRadius();this.adManager.setAdMapSettings({lat:d.lat(),lon:d.lng()},e);this.sendMessage("changeState",{state:b.App.States.INFO});},});b.MapView=a;}(GA));(function(b){var a=b.View.extend({events:{".menu-item":{click:"onMenuItemClick"}},init:function(c){this._parent(c);},register:function(){},render:function(){this.container.innerHTML=this.mustache(this.templates.main,{});return this;},onMenuItemClick:function(c){var d=c.currentTarget.id;switch(d){case"home":this.sendMessage("changeState",{state:b.App.States.GALLERY});break;case"map":this.sendMessage("changeState",{state:b.App.States.MAP});break;case"places":this.sendMessage("changeState",{state:b.App.States.PLACES});break;case"tours":this.sendMessage("changeState",{state:b.App.States.TOURS});break;case"contact":this.sendMessage("changeState",{state:b.App.States.CONTACT});break;}}});b.MenuView=a;}(GA));(function(c){var a="#search-input";var b=c.View.extend({events:{"#search-btn":{click:"onSearch"},"#search-input":{keyup:"onKeyUp"},},init:function(d){this._parent(d);this.dataManager.on("userGeocoded",c.bind(this.onUserGeocoded,this));},register:function(){},render:function(){this.container.innerHTML=this.mustache(this.templates.main,{});return this;},search:function(d,e){this.searchInputText=d||this.getInputValue();if(!this.searchInputText){return;}this.dataManager.geocode(this.searchInputText,true,{success:c.bind(function(i){if(i.length==0){return;}var f=i[0].address;var g=i[0].lat;var h=i[0].lon;this.setInputValue(f);this.sendMessage("drawMarker",{lat:g,lon:h});},this)});},setInputValue:function(d){c.one(a,this.container).value=d;},getInputValue:function(){return c.one(a,this.container).value;},onSearch:function(d){this.search();},onKeyUp:function(d){if(d.keyCode==13){this.search();}},onUserGeocoded:function(d){if(!d||!d.address){return;}this.setInputValue(d.address);}});c.SearchView=b;}(GA));(function(d){var c="#company-name";var b="#keywords";var a=d.View.extend({events:{"#publish":{click:"onPublishClick"},"#previous-step":{click:"onPreviousStepClick"}},init:function(e){this._parent(e);},register:function(){},render:function(){this.container.innerHTML=this.mustache(this.templates.main,{});return this;},inputValid:function(e){var f=d.one(e,this.container).value;if(f.length>0){return true;}else{return false;}},onPreviousStepClick:function(e){this.sendMessage("changeState",{state:d.App.States.MAP});},onPublishClick:function(e){var g=d.one(c,this.container).value;var f=d.one(b,this.container).value;if(this.inputValid(c)&&this.inputValid(b)){this.adManager.setAdInfoSettings(g,f);this.adManager.saveAd();}}});d.InfoView=a;}(GA));(function(b){var a=b.MsgManager.extend({views:[],state:null,lastState:null,init:function(c){this._parent();this.state=c.state;this.language=c.language;this.addViews(c.views||[]);this.appReady=c.appReady;this.register();b.DataManager.getInstance().app=this;},addView:function(c){if(!c){return;}c.app=this;if(this.views.indexOf(c)==-1){this.views.push(c);
}},addViews:function(c){for(var d=0;d<c.length;d++){this.addView(c[d]);}},removeView:function(c){},register:function(){this.onMessage("changeState",this.onChangeState);this.onMessage("reverseState",this.onReverseState);},start:function(){if(this.language){b.LanguageManager.getInstance().loadLanguage(this.language,b.bind(function(){this._start();},this));}else{this._start();}},_start:function(){for(var c=0;c<this.views.length;c++){this.views[c].render();}this.changeState(this.state||"home");if(this.appReady){this.appReady.call(this,[]);}},changeState:function(e){if(e==this.state&&this.lastState!=null){return;}this.lastState=this.state;this.state=e;for(var d=0;d<this.views.length;d++){var c=this.views[d];if(c.hideOnStates.indexOf(this.state)!=-1){this.hideView(c);}else{this.showView(c);}}this.sendMessage("stateChanged",{currentState:this.state,lastState:this.lastState});},hideView:function(c){b.addClass(c.container,"hide-view");this.sendMessage("hideView",c.container);},showView:function(c){b.removeClass(c.container,"hide-view");this.sendMessage("showView",c.container);},onChangeState:function(c){this.changeState(c.state);},onReverseState:function(c){this.changeState(this.lastState);}});b.App=a;b.App.States={};b.App.States.MAP="map";b.App.States.INFO="info";}(GA));